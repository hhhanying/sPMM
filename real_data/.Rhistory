library(data.table)
library(purrr)
library(ggplot2)
library(ggpubr)
library(MOFA2)
library(dplyr)
dt <- fread("ftp://ftp.ebi.ac.uk/pub/databases/mofa/microbiome/data.txt.gz")
metadata <- fread("ftp://ftp.ebi.ac.uk/pub/databases/mofa/microbiome/metadata.txt.gz")
str(dt)
dim(dt)
str(metadata)
dim(metadata)
dt_wide = copy(dt)[, fea := paste(feature, view, sep = ",")][,c("sample","value","fea")] %>%
reshape(idvar = "sample", timevar = "fea", direction = "wide")
View(dt)
View(dt)
View(dt_wide)
View(dt_wide)
dt_wide = copy(dt)[, fea := paste(feature, view, sep = ",")]
dt_wide = copy(dt)[, fea := paste(feature, view, sep = ",")][,c("sample","value","fea")] %>%
reshape(idvar = "sample", timevar = "fea", direction = "wide")
names(dt_wide)
a=names(dt_wide)
substrRight <- function(x, n){
substr(x, nchar(x)-n+1, nchar(x))
}
a=names(dt_wide)
substrRight <- function(x, n){
substr(x, nchar(x)-n+1, nchar(x))
}
b=sapply(a, substrRight)
b=sapply(a, substrRight(8))
b=sapply(a, substrRight(n=8))
b=sapply(a, function(x) substrRight(x,8))
b
b=tapply(a, function(x) substrRight(x,8))
b
b=apply(a, function(x) substrRight(x,8))
b=apply(a, function(x) substrRight(x,8))
s
b=sapply(a, function(x) substrRight(x,8))
b
class(b)
type(b)
is.vector(b)
sum(b[1:180]=="Bacteria")
which(b[1:180]!="Bacteria")
a=names(dt_wide[1:])
a=names(dt_wide)[1:]
a=names(dt_wide)
a=names(dt_wide)[1:]
a=names(dt_wide)[-1]
a
substrRight <- function(x, n){
substr(x, nchar(x)-n+1, nchar(x))
}
b=sapply(a, function(x) substrRight(x,8))
sum(b[1:180]=="Bacteria")
b=sapply(a, function(x) substrRight(x,5))
sum(b[181:198]=="Fungi")
b=sapply(a, function(x) substrRight(x,7))
sum(b[199:240]=="Viruses")
a
a[1]
a[1][-1:-6]
names(dt_wide)[1:241] = sapply(names(dt_wide)[1:241], function(x) substring(x,7))
dt_wide = copy(dt)[, fea := paste(feature, view, sep = "_")][,c("sample","value","fea")] %>%
reshape(idvar = "sample", timevar = "fea", direction = "wide")
names(dt_wide)[1:241] = sapply(names(dt_wide)[1:241], function(x) substring(x,7))
dat = copy(metadata)[, Category := case_when(
Category == "Sepsis" ~ 0,
Category == "Non septic ICU" ~ 1,
Category == "Healthy, no antibiotics" ~ 2,
Category == "Healthy, antibiotics" ~ 3)][, c("sample", "Category")]
View(dt)
View(dat)
dat = merge(dt_wide, dat, by="sample")
dat = merge(dt_wide, dat, by="sample")
dt <- fread("ftp://ftp.ebi.ac.uk/pub/databases/mofa/microbiome/data.txt.gz")
metadata <- fread("ftp://ftp.ebi.ac.uk/pub/databases/mofa/microbiome/metadata.txt.gz")
dt_wide = copy(dt)[, fea := paste(feature, view, sep = "_")][,c("sample","value","fea")] %>%
reshape(idvar = "sample", timevar = "fea", direction = "wide")
names(dt_wide)[1:241] = sapply(names(dt_wide)[1:241], function(x) substring(x,7))
dat = copy(metadata)[, Category := case_when(
Category == "Sepsis" ~ 0,
Category == "Non septic ICU" ~ 1,
Category == "Healthy, no antibiotics" ~ 2,
Category == "Healthy, antibiotics" ~ 3)][, c("sample", "Category")]
dat = merge(dt_wide, dat, by="sample")
dt_wide = copy(dt)[, fea := paste(feature, view, sep = ",")][,c("sample","value","fea")] %>%
reshape(idvar = "sample", timevar = "fea", direction = "wide")
names(dt_wide)[2:241] = sapply(names(dt_wide)[2:241], function(x) substring(x,7))
dt_wide = copy(dt)[, fea := paste(feature, view, sep = "_")][,c("sample","value","fea")] %>%
reshape(idvar = "sample", timevar = "fea", direction = "wide")
names(dt_wide)[1:241] = sapply(names(dt_wide)[1:241], function(x) substring(x,7))
dat = copy(metadata)[, Category := case_when(
Category == "Sepsis" ~ 0,
Category == "Non septic ICU" ~ 1,
Category == "Healthy, no antibiotics" ~ 2,
Category == "Healthy, antibiotics" ~ 3)][, c("sample", "Category")]
dat = merge(dt_wide, dat, by="sample")
dt_wide = copy(dt)[, fea := paste(feature, view, sep = "_")][,c("sample","value","fea")] %>%
reshape(idvar = "sample", timevar = "fea", direction = "wide")
names(dt_wide)[2:241] = sapply(names(dt_wide)[2:241], function(x) substring(x,7))
dat = copy(metadata)[, Category := case_when(
Category == "Sepsis" ~ 0,
Category == "Non septic ICU" ~ 1,
Category == "Healthy, no antibiotics" ~ 2,
Category == "Healthy, antibiotics" ~ 3)][, c("sample", "Category")]
dat = merge(dt_wide, dat, by="sample")
row.has.na <- apply(dat, 1, function(x){any(is.na(x))})
dat$sample[row.has.na] # "TKI_F22" "TKI_F56"
dat = dat[!row.has.na,]
write.csv(dat, "cleaned_data.csv")
getwd()
help("write.csv")
write.csv(dat, "./data/cleaned_data.csv",row.names = FALSE)
dat_test = read.csv("./data/cleaned_data.csv")
View(dat_test)
class(dat)
as.data.frame(dat)
is.identical(dat_test,as.data.frame(dat))
identical(dat_test,as.data.frame(dat))
class(dat)
class(dat_test)
class(as.data.frame(dat))
dat_test[1,]
for(i in 1:242){
if (dat_test[[i]] != dat[[i]]) print(i)
}
dim(dat)
names(dat[181])
names(dat)[181]
names(dat)[182]
names(dat)[182]
names(dat)[199]
names(dat)[200]
